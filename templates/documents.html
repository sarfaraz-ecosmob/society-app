{% extends "base.html" %}

{% block title %}Documents - Society Maintenance App{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1><i class="fas fa-file-alt"></i> Document Management</h1>
        <p>Upload, view, and manage society documents</p>
    </div>
</div>

<div class="action-buttons">
    <a href="{{ url_for('upload_document') }}" class="btn btn-primary">
        <i class="fas fa-upload"></i> Upload Document
    </a>
</div>

<div class="card">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-list"></i> All Documents
        </h5>
    </div>
    <div class="card-body">
        {% if documents %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Title</th>
                        <th>Document Type</th>
                        <th>File Size</th>
                        <th>Uploaded By</th>
                        <th>Upload Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for document in documents %}
                    <tr>
                        <td>
                            <i class="{{ get_file_icon(document.file_extension) }}"></i>
                            <span class="badge bg-secondary ms-1">{{ document.file_extension.upper() }}</span>
                        </td>
                        <td>
                            <strong>{{ document.title }}</strong>
                            {% if document.description %}
                                <br><small class="text-muted">{{ document.description[:50] }}{% if document.description|length > 50 %}...{% endif %}</small>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-info">{{ document.document_type }}</span>
                        </td>
                        <td>{{ document.file_size_formatted }}</td>
                        <td>{{ document.uploader.username }}</td>
                        <td>{{ document.upload_date.strftime('%d/%m/%Y %H:%M') }}</td>
                        <td>
                            <div class="btn-group" role="group">
                                <a href="{{ url_for('view_document', document_id=document.id) }}" 
                                   class="btn btn-sm btn-outline-primary" title="View Document" target="_blank">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{{ url_for('download_document', document_id=document.id) }}" 
                                   class="btn btn-sm btn-outline-success" title="Download Document">
                                    <i class="fas fa-download"></i>
                                </a>
                                <a href="{{ url_for('edit_document', document_id=document.id) }}" 
                                   class="btn btn-sm btn-outline-warning" title="Edit Document">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <button type="button" class="btn btn-sm btn-outline-danger delete-document-btn" 
                                        data-document-id="{{ document.id }}" 
                                        data-document-title="{{ document.title }}"
                                        title="Delete Document">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center text-muted py-5">
            <i class="fas fa-file-alt fa-3x mb-3"></i>
            <h5>No documents uploaded yet</h5>
            <p>Start by uploading your first society document.</p>
            <a href="{{ url_for('upload_document') }}" class="btn btn-primary">
                <i class="fas fa-upload"></i> Upload First Document
            </a>
        </div>
        {% endif %}
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        <h5 class="mb-0">
            <i class="fas fa-info-circle"></i> Document Types & Features
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h6><i class="fas fa-file-alt text-primary"></i> Supported File Types</h6>
                <ul class="text-muted">
                    <li><strong>Documents:</strong> PDF, DOC, DOCX, TXT</li>
                    <li><strong>Images:</strong> PNG, JPG, JPEG, GIF</li>
                    <li><strong>Spreadsheets:</strong> XLS, XLSX</li>
                </ul>
                <p class="text-muted"><small>Maximum file size: 16MB</small></p>
            </div>
            <div class="col-md-6">
                <h6><i class="fas fa-tags text-success"></i> Document Categories</h6>
                <ul class="text-muted">
                    <li><strong>Legal:</strong> Contracts, agreements, legal documents</li>
                    <li><strong>Financial:</strong> Budgets, financial reports, invoices</li>
                    <li><strong>Meeting Minutes:</strong> Board meetings, AGM minutes</li>
                    <li><strong>Maintenance:</strong> Repair reports, maintenance schedules</li>
                    <li><strong>Other:</strong> Miscellaneous society documents</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteDocumentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete the document:</p>
                <p><strong id="documentTitleToDelete"></strong></p>
                <p class="text-danger"><small>This action cannot be undone. The file will be permanently deleted.</small></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteDocumentForm" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-danger">Delete Document</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Delete modal functionality
    const deleteButtons = document.querySelectorAll('.delete-document-btn');
    const deleteModal = document.getElementById('deleteDocumentModal');
    const deleteForm = document.getElementById('deleteDocumentForm');
    const documentTitleToDeleteSpan = document.getElementById('documentTitleToDelete');
    
    deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
            const documentId = this.getAttribute('data-document-id');
            const documentTitle = this.getAttribute('data-document-title');
            
            documentTitleToDeleteSpan.textContent = documentTitle;
            deleteForm.action = '/documents/delete/' + documentId;
            
            // Show the modal
            const bsModal = new bootstrap.Modal(deleteModal);
            bsModal.show();
        });
    });
});
</script>
{% endblock %}